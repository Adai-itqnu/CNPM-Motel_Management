<div class="payments-management">
  <div class="page-header">
    <h1>üí∞ L·ªãch S·ª≠ Thanh To√°n</h1>
    <p class="subtitle">Qu·∫£n l√Ω t·∫•t c·∫£ giao d·ªãch thanh to√°n trong h·ªá th·ªëng</p>
  </div>

  <!-- Search & Filter -->
  <div class="toolbar">
    <div class="search-box">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input type="text" [(ngModel)]="searchText" placeholder="T√¨m theo t√™n, ph√≤ng, m√£ GD..." (input)="onSearch()">
    </div>
    <div class="filters">
      <select [(ngModel)]="filterType" (change)="applyFilters()">
        <option value="all">T·∫•t c·∫£ lo·∫°i</option>
        <option value="Deposit">Ti·ªÅn c·ªçc</option>
        <option value="MonthlyBill">H√≥a ƒë∆°n th√°ng</option>
      </select>
      <select [(ngModel)]="filterStatus" (change)="applyFilters()">
        <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="Success">Th√†nh c√¥ng</option>
        <option value="Pending">Ch·ªù x·ª≠ l√Ω</option>
        <option value="Failed">Th·∫•t b·∫°i</option>
      </select>
      <select [(ngModel)]="filterMonth" (change)="applyFilters()">
        <option value="0">T·∫•t c·∫£ th√°ng</option>
        <option *ngFor="let m of months" [value]="m">Th√°ng {{ m }}</option>
      </select>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-row">
    <div class="stat-card total">
      <span class="stat-icon">üìä</span>
      <div class="stat-content">
        <span class="stat-value">{{ payments.length }}</span>
        <span class="stat-label">T·ªïng giao d·ªãch</span>
      </div>
    </div>
    <div class="stat-card success">
      <span class="stat-icon">‚úÖ</span>
      <div class="stat-content">
        <span class="stat-value">{{ getCountByStatus('Success') }}</span>
        <span class="stat-label">Th√†nh c√¥ng</span>
      </div>
    </div>
    <div class="stat-card pending">
      <span class="stat-icon">‚è≥</span>
      <div class="stat-content">
        <span class="stat-value">{{ getCountByStatus('Pending') }}</span>
        <span class="stat-label">Ch·ªù x·ª≠ l√Ω</span>
      </div>
    </div>
    <div class="stat-card revenue">
      <span class="stat-icon">üíµ</span>
      <div class="stat-content">
        <span class="stat-value">{{ formatShortCurrency(getTotalSuccess()) }}</span>
        <span class="stat-label">T·ªïng thu</span>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i...</p>
  </div>

  <!-- Payments Table -->
  <div class="table-container" *ngIf="!isLoading">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ph√≤ng</th>
          <th>Kh√°ch h√†ng</th>
          <th>Lo·∫°i</th>
          <th>S·ªë ti·ªÅn</th>
          <th>Ph∆∞∆°ng th·ª©c</th>
          <th>M√£ GD</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Ng√†y TT</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let payment of filteredPayments">
          <td class="room-name">{{ payment.roomName }}</td>
          <td>{{ payment.userName }}</td>
          <td>
            <span class="type-badge" [class.deposit]="payment.paymentType === 'Deposit'">
              {{ payment.paymentType === 'Deposit' ? 'Ti·ªÅn c·ªçc' : 'H√≥a ƒë∆°n' }}
            </span>
          </td>
          <td class="amount">{{ formatCurrency(payment.amount) }}</td>
          <td>{{ payment.paymentMethod }}</td>
          <td class="txn-id">{{ payment.providerTxnId || '-' }}</td>
          <td>
            <span class="status-badge" [ngClass]="'status-' + payment.status.toLowerCase()">
              {{ getStatusLabel(payment.status) }}
            </span>
          </td>
          <td>{{ formatDate(payment.paymentDate) }}</td>
        </tr>
      </tbody>
    </table>

    <div class="empty-state" *ngIf="filteredPayments.length === 0">
      <p>Kh√¥ng c√≥ giao d·ªãch n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc</p>
    </div>
  </div>
</div>
