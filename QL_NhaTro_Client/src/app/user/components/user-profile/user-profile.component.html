<div class="profile-container">
  <!-- Toast Notification -->
  <div class="toast" *ngIf="message" [class.toast-success]="messageType === 'success'"
    [class.toast-error]="messageType === 'error'">
    <span>{{ message }}</span>
  </div>

  <!-- Header -->
  <div class="profile-header">
    <h1>Thông tin cá nhân</h1>
    <p>Quản lý thông tin tài khoản</p>
  </div>

  <!-- Profile Card -->
  <div class="profile-card">
    <!-- Avatar -->
    <div class="avatar-section">
      <div class="avatar-wrapper" (click)="triggerFileInput()">
        <img *ngIf="currentUser?.avatarUrl" [src]="getAvatarUrl()" class="avatar-image" />
        <div *ngIf="!currentUser?.avatarUrl" class="large-avatar">{{ getInitials() }}</div>
        <div class="avatar-overlay">
          <span>Đổi ảnh</span>
        </div>
      </div>
      <input type="file" id="avatarInput" accept="image/*" (change)="onFileSelected($event)" style="display:none">
      <h2>{{ currentUser?.fullName }}</h2>
      <p class="user-role">{{ currentUser?.role === 'admin' ? 'Quản trị viên' : 'Người thuê trọ' }}</p>
    </div>

    <!-- Info -->
    <div class="info-section">
      <div class="section-header">
        <h3>Thông tin chi tiết</h3>
        <button *ngIf="!isEditing" class="btn-edit" (click)="toggleEdit()">Chỉnh sửa</button>
      </div>

      <!-- View Mode -->
      <div *ngIf="!isEditing" class="info-grid">
        <div class="info-item">
          <label>Họ và tên</label>
          <p>{{ currentUser?.fullName }}</p>
        </div>
        <div class="info-item">
          <label>Email</label>
          <p>{{ currentUser?.email }}</p>
        </div>
        <div class="info-item">
          <label>Số điện thoại</label>
          <p>{{ currentUser?.phone || 'Chưa cập nhật' }}</p>
        </div>
        <div class="info-item">
          <label>CCCD</label>
          <p>{{ currentUser?.idCard || 'Chưa cập nhật' }}</p>
        </div>
        <div class="info-item full-width">
          <label>Địa chỉ</label>
          <p>{{ currentUser?.address || 'Chưa cập nhật' }}</p>
        </div>
      </div>

      <!-- Edit Mode -->
      <form *ngIf="isEditing">
        <div class="form-group">
          <label>Họ và tên</label>
          <input type="text" [(ngModel)]="profileForm.fullName" name="fullName">
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="profileForm.email" name="email">
        </div>

        <div class="form-group">
          <label>Số điện thoại <span class="required">*</span></label>
          <input type="text" [(ngModel)]="profileForm.phone" name="phone" (input)="phoneError = ''">
          <span *ngIf="phoneError" class="error-message">{{ phoneError }}</span>
        </div>

        <div class="form-group">
          <label>CCCD <span class="required">*</span></label>
          <input type="text" [(ngModel)]="profileForm.idCard" name="idCard" (input)="idCardError = ''">
          <span *ngIf="idCardError" class="error-message">{{ idCardError }}</span>
        </div>

        <div class="form-group">
          <label>Địa chỉ</label>
          <textarea rows="3" [(ngModel)]="profileForm.address" name="address"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-save" (click)="saveProfile()">Lưu</button>
          <button type="button" class="btn-cancel" (click)="cancelEdit()">Hủy</button>
        </div>
      </form>
    </div>
  </div>
</div>