<div class="admin-notifications">
  <div class="page-header">
    <h1>üì¢ G·ª≠i Th√¥ng B√°o</h1>
    <p class="subtitle">G·ª≠i th√¥ng b√°o ƒë·∫øn ng∆∞·ªùi thu√™ trong h·ªá th·ªëng</p>
  </div>

  <div class="notifications-layout">
    <!-- Send Notification Form -->
    <div class="send-form-card">
      <h2>‚úâÔ∏è So·∫°n th√¥ng b√°o m·ªõi</h2>
      
      <form (ngSubmit)="sendNotification()">
        <div class="form-group">
          <label>Ng∆∞·ªùi nh·∫≠n <span class="required">*</span></label>
          <select [(ngModel)]="notification.targetType" name="targetType" (change)="onTargetChange()">
            <option value="all">T·∫•t c·∫£ ng∆∞·ªùi d√πng</option>
            <option value="user">Ch·ªçn ng∆∞·ªùi d√πng</option>
          </select>
        </div>

        <div class="form-group" *ngIf="notification.targetType === 'user'">
          <label>Ch·ªçn ng∆∞·ªùi nh·∫≠n <span class="required">*</span></label>
          <select [(ngModel)]="notification.userId" name="userId">
            <option value="">-- Ch·ªçn ng∆∞·ªùi d√πng --</option>
            <option *ngFor="let user of users" [value]="user.id">
              {{ user.fullName }} ({{ user.email }})
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Lo·∫°i th√¥ng b√°o</label>
          <select [(ngModel)]="notification.type" name="type">
            <option value="System">H·ªá th·ªëng</option>
            <option value="Payment">Thanh to√°n</option>
            <option value="Warning">C·∫£nh b√°o</option>
            <option value="Admin">T·ª´ qu·∫£n tr·ªã</option>
          </select>
        </div>

        <div class="form-group">
          <label>Ti√™u ƒë·ªÅ <span class="required">*</span></label>
          <input type="text" [(ngModel)]="notification.title" name="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ th√¥ng b√°o...">
        </div>

        <div class="form-group">
          <label>N·ªôi dung <span class="required">*</span></label>
          <textarea [(ngModel)]="notification.content" name="content" rows="5" placeholder="Nh·∫≠p n·ªôi dung th√¥ng b√°o..."></textarea>
        </div>

        <div class="form-group">
          <label>Link ƒë√≠nh k√®m (t√πy ch·ªçn)</label>
          <input type="text" [(ngModel)]="notification.link" name="link" placeholder="/user/my-bills">
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="resetForm()">H·ªßy</button>
          <button type="submit" class="btn-primary" [disabled]="isSending">
            {{ isSending ? 'ƒêang g·ª≠i...' : 'üì§ G·ª≠i th√¥ng b√°o' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Recent Sent Notifications -->
    <div class="recent-notifications-card">
      <h2>üìã Th√¥ng b√°o ƒë√£ g·ª≠i g·∫ßn ƒë√¢y</h2>
      
      <div class="loading-mini" *ngIf="isLoadingHistory">
        <div class="spinner-mini"></div>
      </div>

      <div class="notification-list" *ngIf="!isLoadingHistory">
        <div class="notification-item" *ngFor="let notif of recentNotifications">
          <div class="notif-icon">{{ getTypeIcon(notif.type) }}</div>
          <div class="notif-content">
            <strong>{{ notif.title }}</strong>
            <p>{{ notif.content }}</p>
            <small>G·ª≠i ƒë·∫øn: {{ notif.recipientName || 'T·∫•t c·∫£' }} ‚Ä¢ {{ formatDate(notif.createdAt) }}</small>
          </div>
        </div>

        <div class="empty-state" *ngIf="recentNotifications.length === 0">
          <p>Ch∆∞a c√≥ th√¥ng b√°o n√†o ƒë∆∞·ª£c g·ª≠i</p>
        </div>
      </div>
    </div>
  </div>
</div>
