<div class="bill-management">
  <div class="page-header">
    <h1>Qu·∫£n L√Ω H√≥a ƒê∆°n</h1>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'monthly'"
      (click)="switchTab('monthly')">
      üìÑ H√≥a ƒê∆°n H√†ng Th√°ng
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'deposit'"
      (click)="switchTab('deposit')">
      üí∞ Ti·ªÅn C·ªçc
    </button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i...</p>
  </div>

  <!-- Monthly Bills Tab -->
  <div class="tab-content" *ngIf="!isLoading && activeTab === 'monthly'">
    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <label>Th√°ng:</label>
        <select [(ngModel)]="filterMonth">
          <option [value]="0">T·∫•t c·∫£</option>
          <option *ngFor="let m of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="m">Th√°ng {{ m }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>NƒÉm:</label>
        <select [(ngModel)]="filterYear">
          <option [value]="2024">2024</option>
          <option [value]="2025">2025</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Tr·∫°ng th√°i:</label>
        <select [(ngModel)]="filterStatus">
          <option value="all">T·∫•t c·∫£</option>
          <option value="Pending">Ch∆∞a thanh to√°n</option>
          <option value="Paid">ƒê√£ thanh to√°n</option>
          <option value="Overdue">Qu√° h·∫°n</option>
        </select>
      </div>
    </div>

    <!-- Bills Table -->
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Ph√≤ng</th>
            <th>Kh√°ch thu√™</th>
            <th>K·ª≥</th>
            <th>ƒêi·ªán</th>
            <th>N∆∞·ªõc</th>
            <th>Ti·ªÅn ph√≤ng</th>
            <th>T·ªïng</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H·∫°n TT</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of filteredBills">
            <td class="room-name">{{ bill.roomName }}</td>
            <td>{{ bill.userName }}</td>
            <td>{{ bill.month }}/{{ bill.year }}</td>
            <td>
              <span class="detail-text">{{ bill.electricityNewIndex - bill.electricityOldIndex }} kWh</span>
              <span class="detail-amount">{{ formatCurrency(bill.electricityTotal) }}</span>
            </td>
            <td>
              <span class="detail-text">{{ bill.waterNewIndex - bill.waterOldIndex }} m¬≥</span>
              <span class="detail-amount">{{ formatCurrency(bill.waterTotal) }}</span>
            </td>
            <td>{{ formatCurrency(bill.roomPrice) }}</td>
            <td class="total-amount">{{ formatCurrency(bill.totalAmount) }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(bill.status)">
                {{ getStatusLabel(bill.status) }}
              </span>
            </td>
            <td>{{ formatDate(bill.dueDate) }}</td>
            <td class="actions">
              <button 
                class="btn-action btn-paid" 
                *ngIf="bill.status === 'Pending'"
                (click)="updateBillStatus(bill, 'Paid')"
                title="ƒê√°nh d·∫•u ƒë√£ thanh to√°n">
                ‚úì
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="empty-state" *ngIf="filteredBills.length === 0">
        <p>Kh√¥ng c√≥ h√≥a ƒë∆°n n√†o</p>
      </div>
    </div>
  </div>

  <!-- Deposit Payments Tab -->
  <div class="tab-content" *ngIf="!isLoading && activeTab === 'deposit'">
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Ph√≤ng</th>
            <th>Kh√°ch</th>
            <th>S·ªë ti·ªÅn</th>
            <th>Ph∆∞∆°ng th·ª©c</th>
            <th>M√£ GD</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ng√†y TT</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let deposit of deposits">
            <td class="room-name">{{ deposit.roomName }}</td>
            <td>{{ deposit.userName }}</td>
            <td class="total-amount">{{ formatCurrency(deposit.amount) }}</td>
            <td>{{ deposit.paymentMethod }}</td>
            <td class="txn-id">{{ deposit.providerTxnId || '-' }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(deposit.status)">
                {{ deposit.status }}
              </span>
            </td>
            <td>{{ formatDate(deposit.paymentDate) }}</td>
          </tr>
        </tbody>
      </table>

      <div class="empty-state" *ngIf="deposits.length === 0">
        <p>Kh√¥ng c√≥ giao d·ªãch ti·ªÅn c·ªçc n√†o</p>
      </div>
    </div>
  </div>
</div>